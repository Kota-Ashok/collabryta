{"ast":null,"code":"import React,{useState,useEffect,useRef,useCallback}from\"react\";import{Search,Phone,Video,Users,Paperclip,Smile,Send,Check,ArrowLeft,X}from\"lucide-react\";import{messageService}from\"../../services/messageService\";import{userService}from\"../../services/userService\";import{authService}from\"../../services/authService\";import{useNotifications}from\"../../context/NotificationContext\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CreateGroupModal=_ref=>{let{isOpen,onClose,users,onCreate}=_ref;const[groupName,setGroupName]=useState(\"\");const[selectedIds,setSelectedIds]=useState([]);if(!isOpen)return null;const toggleUser=id=>{setSelectedIds(prev=>prev.includes(id)?prev.filter(x=>x!==id):[...prev,id]);};const handleSubmit=()=>{if(!groupName||selectedIds.length===0)return;onCreate(groupName,selectedIds);onClose();setGroupName(\"\");setSelectedIds([]);};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl animate-in fade-in zoom-in duration-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-slate-800\",children:\"Create Group Chat\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,children:/*#__PURE__*/_jsx(X,{className:\"text-slate-400 hover:text-red-500 transition\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-slate-700 mb-1\",children:\"Group Name\"}),/*#__PURE__*/_jsx(\"input\",{className:\"w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition\",value:groupName,onChange:e=>setGroupName(e.target.value),placeholder:\"e.g. Project Alpha Team\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-slate-700 mb-2\",children:\"Select Members\"}),/*#__PURE__*/_jsx(\"div\",{className:\"max-h-60 overflow-y-auto space-y-2 border border-slate-100 rounded-xl p-2 bg-slate-50/50\",children:users.map(u=>/*#__PURE__*/_jsxs(\"div\",{onClick:()=>toggleUser(u.id),className:\"flex items-center gap-3 p-2 rounded-lg cursor-pointer transition \".concat(selectedIds.includes(u.id)?'bg-blue-50 border border-blue-200 shadow-sm':'hover:bg-white border border-transparent'),children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-white transition \".concat(selectedIds.includes(u.id)?'bg-blue-500':'bg-slate-300'),children:u.name.substring(0,2).toUpperCase()}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium \".concat(selectedIds.includes(u.id)?'text-blue-900':'text-slate-600'),children:u.name}),selectedIds.includes(u.id)&&/*#__PURE__*/_jsx(Check,{size:16,className:\"ml-auto text-blue-600\"})]},u.id))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"px-4 py-2 text-slate-500 hover:bg-slate-100 rounded-xl font-medium transition\",children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmit,disabled:!groupName||selectedIds.length===0,className:\"px-6 py-2 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition shadow-sm hover:shadow-md\",children:\"Create Group\"})]})]})});};const MessagesPage=()=>{var _activeChat$name;// State\nconst[chats,setChats]=useState([]);const[messages,setMessages]=useState([]);const[currentUser,setCurrentUser]=useState(null);const[activeChatId,setActiveChatId]=useState(null);const[searchQuery,setSearchQuery]=useState(\"\");const[allUsers,setAllUsers]=useState([]);const[inputText,setInputText]=useState(\"\");const[isMobileChatOpen,setIsMobileChatOpen]=useState(false);const[isGroupModalOpen,setIsGroupModalOpen]=useState(false);const messagesEndRef=useRef(null);const{subscribe}=useNotifications();const loadChats=useCallback(async()=>{try{const data=await messageService.getChats();setChats(data);}catch(e){console.error(e);}},[]);const loadUserAndChats=useCallback(async()=>{try{const user=await authService.getCurrentUser();setCurrentUser(user);await loadChats();const users=await userService.getAllUsers();setAllUsers(users.filter(u=>u.id!==user.id));}catch(e){console.error(e);}},[loadChats]);const loadMessages=useCallback(async chatId=>{try{const msgs=await messageService.getMessages(chatId);setMessages(msgs);// Mark as read after loading messages\nawait messageService.markAsRead(chatId);// Immediately refresh chat list to clear unread bubble locally\nloadChats();}catch(e){console.error(e);}},[loadChats]);// Initial Load\nuseEffect(()=>{loadUserAndChats();},[loadUserAndChats]);// Real-time updates via WebSocket\nuseEffect(()=>{const unsubscribe=subscribe('message',newMessage=>{// Update messages if this message is for the active chat\nif(activeChatId===newMessage.chat_id){setMessages(prev=>{if(prev.find(m=>m.id===newMessage.id))return prev;return[...prev,newMessage];});// Mark as read if active\nmessageService.markAsRead(newMessage.chat_id);}// Always refresh chats to show last message/unread count\nloadChats();});return unsubscribe;},[activeChatId,subscribe,loadChats]);// Load Messages when active chat changes\nuseEffect(()=>{if(activeChatId){loadMessages(activeChatId);}},[activeChatId,loadMessages]);const messagesContainerRef=useRef(null);const scrollToBottom=()=>{if(messagesContainerRef.current){const{scrollHeight,clientHeight}=messagesContainerRef.current;messagesContainerRef.current.scrollTo({top:scrollHeight-clientHeight,behavior:'smooth'});}};// Auto-scroll\nuseEffect(()=>{scrollToBottom();},[messages,activeChatId]);const handleSendMessage=async()=>{if(!inputText.trim()||!activeChatId)return;try{await messageService.sendMessage(activeChatId,inputText);setInputText(\"\");loadMessages(activeChatId);loadChats();// Force scroll to bottom immediately after send\nsetTimeout(scrollToBottom,100);}catch(e){console.error(e);}};const handleCreateP2PChat=async userId=>{try{const chat=await messageService.createChat([userId],undefined,false);setChats(prev=>{if(prev.find(c=>c.id===chat.id))return prev;return[chat,...prev];});setActiveChatId(chat.id);setIsMobileChatOpen(true);setSearchQuery(\"\");}catch(e){console.error(e);}};const handleCreateGroup=async(name,userIds)=>{try{const chat=await messageService.createChat(userIds,name,true);setChats(prev=>[chat,...prev]);setActiveChatId(chat.id);setIsMobileChatOpen(true);}catch(e){console.error(e);alert(\"Failed to create group\");}};// Filter Logic\nconst filteredChats=chats.filter(c=>{var _c$name;return(_c$name=c.name)===null||_c$name===void 0?void 0:_c$name.toLowerCase().includes(searchQuery.toLowerCase());});const suggestedUsers=searchQuery?allUsers.filter(u=>u.name.toLowerCase().includes(searchQuery.toLowerCase())):[];const activeChat=chats.find(c=>c.id===activeChatId);return/*#__PURE__*/_jsxs(\"div\",{className:\"flex h-[calc(100vh-64px)] bg-slate-50 overflow-hidden font-sans\",children:[/*#__PURE__*/_jsx(CreateGroupModal,{isOpen:isGroupModalOpen,onClose:()=>setIsGroupModalOpen(false),users:allUsers,onCreate:handleCreateGroup}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full md:w-80 lg:w-96 bg-white border-r border-slate-200 flex flex-col \".concat(isMobileChatOpen?'hidden md:flex':'flex'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border-b border-slate-100\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-xl font-bold text-slate-800 tracking-tight\",children:\"Messages\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsGroupModalOpen(true),className:\"p-2 text-slate-500 hover:text-blue-600 hover:bg-blue-50 rounded-full transition\",title:\"Create Group\",children:/*#__PURE__*/_jsx(Users,{size:20})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative group\",children:[/*#__PURE__*/_jsx(Search,{className:\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition\",size:16}),/*#__PURE__*/_jsx(\"input\",{className:\"w-full bg-slate-50 border-none rounded-xl py-2.5 pl-10 pr-4 text-sm focus:ring-2 focus:ring-blue-100 transition placeholder-slate-400 outline-none\",placeholder:\"Search chats or people...\",value:searchQuery,onChange:e=>setSearchQuery(e.target.value)})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 space-y-1\",children:[filteredChats.map(chat=>{var _chat$name;return/*#__PURE__*/_jsxs(\"div\",{onClick:()=>{setActiveChatId(chat.id);setIsMobileChatOpen(true);},className:\"p-3 rounded-xl flex items-center gap-3 cursor-pointer transition-all \".concat(activeChatId===chat.id?'bg-blue-50 border-blue-100 shadow-sm':'hover:bg-slate-50 border-transparent',\" border\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold shadow-sm \".concat(chat.is_group?'bg-indigo-500':'bg-gradient-to-br from-blue-400 to-blue-600'),children:chat.is_group?/*#__PURE__*/_jsx(Users,{size:16}):((_chat$name=chat.name)===null||_chat$name===void 0?void 0:_chat$name.substring(0,2).toUpperCase())||\"?\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-baseline mb-0.5\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-semibold truncate \".concat(activeChatId===chat.id?'text-blue-900':'text-slate-800'),children:chat.name}),/*#__PURE__*/_jsx(\"span\",{className:\"text-[10px] text-slate-400\",children:chat.last_message_time?new Date(chat.last_message_time).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}):''})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-slate-500 truncate max-w-[85%]\",children:chat.last_message||/*#__PURE__*/_jsx(\"span\",{className:\"italic opacity-50\",children:\"No messages yet\"})}),chat.unread_count&&chat.unread_count>0?/*#__PURE__*/_jsx(\"span\",{className:\"bg-blue-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[1.25rem] text-center shadow-sm\",children:chat.unread_count}):null]})]})]},chat.id);}),filteredChats.length===0&&!searchQuery&&/*#__PURE__*/_jsx(\"div\",{className:\"text-center p-8 text-slate-400\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:\"No conversations yet.\"})})]}),suggestedUsers.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 border-t border-slate-100 mt-2\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"px-3 py-2 text-xs font-bold text-slate-400 uppercase tracking-wider\",children:\"Start New Chat\"}),suggestedUsers.map(user=>/*#__PURE__*/_jsxs(\"div\",{onClick:()=>handleCreateP2PChat(user.id),className:\"p-3 rounded-xl flex items-center gap-3 cursor-pointer hover:bg-slate-50 transition\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center text-slate-600 font-bold text-xs ring-2 ring-white\",children:user.name.substring(0,2).toUpperCase()}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-semibold text-slate-700\",children:user.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-slate-400\",children:\"Click to message\"})]}),/*#__PURE__*/_jsx(ArrowLeft,{size:14,className:\"ml-auto text-slate-300 rotate-180\"})]},user.id))]})]})]}),activeChat?/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 flex flex-col bg-[#f8fafc] \".concat(isMobileChatOpen?'flex':'hidden md:flex'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 shadow-sm z-10\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsMobileChatOpen(false),className:\"md:hidden p-2 -ml-2 text-slate-500 hover:bg-gray-100 rounded-full\",children:/*#__PURE__*/_jsx(ArrowLeft,{size:20})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-sm \".concat(activeChat.is_group?'bg-indigo-500':'bg-gradient-to-br from-blue-400 to-blue-600'),children:activeChat.is_group?/*#__PURE__*/_jsx(Users,{size:18}):(_activeChat$name=activeChat.name)===null||_activeChat$name===void 0?void 0:_activeChat$name.substring(0,2).toUpperCase()}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"font-bold text-slate-800 text-[15px]\",children:activeChat.name}),activeChat.is_group&&/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-slate-500 font-medium bg-slate-100 px-2 py-0.5 rounded-full\",children:\"Group Chat\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2 text-slate-400\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"p-2 hover:bg-slate-50 hover:text-blue-600 rounded-full transition\",children:/*#__PURE__*/_jsx(Phone,{size:20})}),/*#__PURE__*/_jsx(\"button\",{className:\"p-2 hover:bg-slate-50 hover:text-blue-600 rounded-full transition\",children:/*#__PURE__*/_jsx(Video,{size:20})})]})]}),/*#__PURE__*/_jsxs(\"div\",{ref:messagesContainerRef,className:\"flex-1 overflow-y-auto p-6 space-y-3 bg-[radial-gradient(#e2e8f0_1px,transparent_1px)] [background-size:20px_20px]\",children:[messages.map((msg,idx)=>{var _msg$sender;const isMe=msg.sender_id===(currentUser===null||currentUser===void 0?void 0:currentUser.id);const showSender=!isMe&&activeChat.is_group&&(idx===0||messages[idx-1].sender_id!==msg.sender_id);return/*#__PURE__*/_jsx(\"div\",{className:\"flex w-full \".concat(isMe?'justify-end':'justify-start'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col max-w-[75%] md:max-w-[60%] \".concat(isMe?'items-end':'items-start'),children:[showSender&&/*#__PURE__*/_jsx(\"span\",{className:\"text-[10px] text-slate-500 mb-1 ml-2 font-medium\",children:((_msg$sender=msg.sender)===null||_msg$sender===void 0?void 0:_msg$sender.name)||'Unknown'}),/*#__PURE__*/_jsx(\"div\",{className:\"px-4 py-2.5 rounded-2xl shadow-sm text-[14px] leading-relaxed break-words \".concat(isMe?'bg-blue-600 text-white rounded-br-none':'bg-white text-slate-800 border border-slate-100 rounded-bl-none'),children:/*#__PURE__*/_jsx(\"p\",{children:msg.content})}),/*#__PURE__*/_jsx(\"span\",{className:\"text-[10px] text-slate-400 mt-1 px-1 font-medium opacity-80\",children:new Date(msg.timestamp).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})})]})},msg.id);}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-white border-t border-slate-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 bg-slate-50 border border-slate-200 rounded-2xl p-2 pr-2 shadow-sm focus-within:ring-2 focus-within:ring-blue-100 focus-within:border-blue-300 transition-all\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"p-2 text-slate-400 hover:text-blue-600 transition\",children:/*#__PURE__*/_jsx(Paperclip,{size:20})}),/*#__PURE__*/_jsx(\"input\",{className:\"flex-1 bg-transparent border-none focus:ring-0 text-slate-700 placeholder-slate-400 text-sm h-10\",placeholder:\"Type a message...\",value:inputText,onChange:e=>setInputText(e.target.value),onKeyDown:e=>e.key==='Enter'&&handleSendMessage()}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSendMessage,disabled:!inputText.trim(),className:\"p-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition shadow-sm disabled:opacity-50 disabled:cursor-not-allowed hover:scale-105 active:scale-95\",children:/*#__PURE__*/_jsx(Send,{size:18,fill:\"currentColor\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center mt-2\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-[10px] text-slate-300\",children:\"Press Enter to send\"})})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"hidden md:flex flex-1 flex-col items-center justify-center text-slate-400 bg-slate-50/50\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-24 h-24 bg-white rounded-full flex items-center justify-center mb-6 shadow-sm border border-slate-100\",children:/*#__PURE__*/_jsx(Smile,{size:40,className:\"text-blue-200\"})}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-bold text-slate-700 mb-2\",children:\"My Messages\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm max-w-xs text-center text-slate-500\",children:\"Pick a person or group from the left to start chatting.\"})]})]});};export default MessagesPage;","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","Search","Phone","Video","Users","Paperclip","Smile","Send","Check","ArrowLeft","X","messageService","userService","authService","useNotifications","jsx","_jsx","jsxs","_jsxs","CreateGroupModal","_ref","isOpen","onClose","users","onCreate","groupName","setGroupName","selectedIds","setSelectedIds","toggleUser","id","prev","includes","filter","x","handleSubmit","length","className","children","onClick","value","onChange","e","target","placeholder","map","u","concat","name","substring","toUpperCase","size","disabled","MessagesPage","_activeChat$name","chats","setChats","messages","setMessages","currentUser","setCurrentUser","activeChatId","setActiveChatId","searchQuery","setSearchQuery","allUsers","setAllUsers","inputText","setInputText","isMobileChatOpen","setIsMobileChatOpen","isGroupModalOpen","setIsGroupModalOpen","messagesEndRef","subscribe","loadChats","data","getChats","console","error","loadUserAndChats","user","getCurrentUser","getAllUsers","loadMessages","chatId","msgs","getMessages","markAsRead","unsubscribe","newMessage","chat_id","find","m","messagesContainerRef","scrollToBottom","current","scrollHeight","clientHeight","scrollTo","top","behavior","handleSendMessage","trim","sendMessage","setTimeout","handleCreateP2PChat","userId","chat","createChat","undefined","c","handleCreateGroup","userIds","alert","filteredChats","_c$name","toLowerCase","suggestedUsers","activeChat","title","_chat$name","is_group","last_message_time","Date","toLocaleTimeString","hour","minute","last_message","unread_count","ref","msg","idx","_msg$sender","isMe","sender_id","showSender","sender","content","timestamp","onKeyDown","key","fill"],"sources":["D:/Collabryta/collabryta-frontend/src/pages/Messages/MessagesPage.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from \"react\";\r\nimport {\r\n    Search, Phone, Video, Users, Paperclip, Smile, Send,\r\n    Check, ArrowLeft, X\r\n} from \"lucide-react\";\r\nimport { messageService, Chat, Message } from \"../../services/messageService\";\r\nimport { userService, User } from \"../../services/userService\";\r\nimport { authService } from \"../../services/authService\";\r\nimport { useNotifications } from \"../../context/NotificationContext\";\r\n\r\nconst CreateGroupModal = ({ isOpen, onClose, users, onCreate }: any) => {\r\n    const [groupName, setGroupName] = useState(\"\");\r\n    const [selectedIds, setSelectedIds] = useState<number[]>([]);\r\n\r\n    if (!isOpen) return null;\r\n\r\n    const toggleUser = (id: number) => {\r\n        setSelectedIds(prev => prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id]);\r\n    };\r\n\r\n    const handleSubmit = () => {\r\n        if (!groupName || selectedIds.length === 0) return;\r\n        onCreate(groupName, selectedIds);\r\n        onClose();\r\n        setGroupName(\"\");\r\n        setSelectedIds([]);\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n            <div className=\"bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl animate-in fade-in zoom-in duration-200\">\r\n                <div className=\"flex justify-between items-center mb-4\">\r\n                    <h3 className=\"text-xl font-bold text-slate-800\">Create Group Chat</h3>\r\n                    <button onClick={onClose}><X className=\"text-slate-400 hover:text-red-500 transition\" /></button>\r\n                </div>\r\n\r\n                <div className=\"mb-4\">\r\n                    <label className=\"block text-sm font-medium text-slate-700 mb-1\">Group Name</label>\r\n                    <input\r\n                        className=\"w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition\"\r\n                        value={groupName}\r\n                        onChange={e => setGroupName(e.target.value)}\r\n                        placeholder=\"e.g. Project Alpha Team\"\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"mb-6\">\r\n                    <label className=\"block text-sm font-medium text-slate-700 mb-2\">Select Members</label>\r\n                    <div className=\"max-h-60 overflow-y-auto space-y-2 border border-slate-100 rounded-xl p-2 bg-slate-50/50\">\r\n                        {users.map((u: User) => (\r\n                            <div\r\n                                key={u.id}\r\n                                onClick={() => toggleUser(u.id)}\r\n                                className={`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition ${selectedIds.includes(u.id) ? 'bg-blue-50 border border-blue-200 shadow-sm' : 'hover:bg-white border border-transparent'}`}\r\n                            >\r\n                                <div className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-white transition ${selectedIds.includes(u.id) ? 'bg-blue-500' : 'bg-slate-300'}`}>\r\n                                    {u.name.substring(0, 2).toUpperCase()}\r\n                                </div>\r\n                                <span className={`text-sm font-medium ${selectedIds.includes(u.id) ? 'text-blue-900' : 'text-slate-600'}`}>{u.name}</span>\r\n                                {selectedIds.includes(u.id) && <Check size={16} className=\"ml-auto text-blue-600\" />}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex justify-end gap-3\">\r\n                    <button onClick={onClose} className=\"px-4 py-2 text-slate-500 hover:bg-slate-100 rounded-xl font-medium transition\">Cancel</button>\r\n                    <button\r\n                        onClick={handleSubmit}\r\n                        disabled={!groupName || selectedIds.length === 0}\r\n                        className=\"px-6 py-2 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition shadow-sm hover:shadow-md\"\r\n                    >\r\n                        Create Group\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst MessagesPage: React.FC = () => {\r\n    // State\r\n    const [chats, setChats] = useState<Chat[]>([]);\r\n    const [messages, setMessages] = useState<Message[]>([]);\r\n    const [currentUser, setCurrentUser] = useState<any>(null);\r\n    const [activeChatId, setActiveChatId] = useState<number | null>(null);\r\n\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n    const [allUsers, setAllUsers] = useState<User[]>([]);\r\n\r\n    const [inputText, setInputText] = useState(\"\");\r\n    const [isMobileChatOpen, setIsMobileChatOpen] = useState(false);\r\n\r\n    const [isGroupModalOpen, setIsGroupModalOpen] = useState(false);\r\n\r\n    const messagesEndRef = useRef<HTMLDivElement>(null);\r\n    const { subscribe } = useNotifications();\r\n\r\n    const loadChats = useCallback(async () => {\r\n        try {\r\n            const data = await messageService.getChats();\r\n            setChats(data);\r\n        } catch (e) { console.error(e); }\r\n    }, []);\r\n\r\n    const loadUserAndChats = useCallback(async () => {\r\n        try {\r\n            const user = await authService.getCurrentUser();\r\n            setCurrentUser(user);\r\n            await loadChats();\r\n            const users = await userService.getAllUsers();\r\n            setAllUsers(users.filter(u => u.id !== user.id));\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }, [loadChats]);\r\n\r\n    const loadMessages = useCallback(async (chatId: number) => {\r\n        try {\r\n            const msgs = await messageService.getMessages(chatId);\r\n            setMessages(msgs);\r\n\r\n            // Mark as read after loading messages\r\n            await messageService.markAsRead(chatId);\r\n\r\n            // Immediately refresh chat list to clear unread bubble locally\r\n            loadChats();\r\n        } catch (e) { console.error(e); }\r\n    }, [loadChats]);\r\n\r\n    // Initial Load\r\n    useEffect(() => {\r\n        loadUserAndChats();\r\n    }, [loadUserAndChats]);\r\n\r\n    // Real-time updates via WebSocket\r\n    useEffect(() => {\r\n        const unsubscribe = subscribe('message', (newMessage: Message) => {\r\n            // Update messages if this message is for the active chat\r\n            if (activeChatId === newMessage.chat_id) {\r\n                setMessages(prev => {\r\n                    if (prev.find(m => m.id === newMessage.id)) return prev;\r\n                    return [...prev, newMessage];\r\n                });\r\n                // Mark as read if active\r\n                messageService.markAsRead(newMessage.chat_id);\r\n            }\r\n            // Always refresh chats to show last message/unread count\r\n            loadChats();\r\n        });\r\n\r\n        return unsubscribe;\r\n    }, [activeChatId, subscribe, loadChats]);\r\n\r\n    // Load Messages when active chat changes\r\n    useEffect(() => {\r\n        if (activeChatId) {\r\n            loadMessages(activeChatId);\r\n        }\r\n    }, [activeChatId, loadMessages]);\r\n\r\n    const messagesContainerRef = useRef<HTMLDivElement>(null);\r\n\r\n    const scrollToBottom = () => {\r\n        if (messagesContainerRef.current) {\r\n            const { scrollHeight, clientHeight } = messagesContainerRef.current;\r\n            messagesContainerRef.current.scrollTo({\r\n                top: scrollHeight - clientHeight,\r\n                behavior: 'smooth'\r\n            });\r\n        }\r\n    };\r\n\r\n    // Auto-scroll\r\n    useEffect(() => {\r\n        scrollToBottom();\r\n    }, [messages, activeChatId]);\r\n\r\n    const handleSendMessage = async () => {\r\n        if (!inputText.trim() || !activeChatId) return;\r\n        try {\r\n            await messageService.sendMessage(activeChatId, inputText);\r\n            setInputText(\"\");\r\n            loadMessages(activeChatId);\r\n            loadChats();\r\n            // Force scroll to bottom immediately after send\r\n            setTimeout(scrollToBottom, 100);\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    };\r\n\r\n    const handleCreateP2PChat = async (userId: number) => {\r\n        try {\r\n            const chat = await messageService.createChat([userId], undefined, false);\r\n            setChats(prev => {\r\n                if (prev.find(c => c.id === chat.id)) return prev;\r\n                return [chat, ...prev];\r\n            });\r\n            setActiveChatId(chat.id);\r\n            setIsMobileChatOpen(true);\r\n            setSearchQuery(\"\");\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    };\r\n\r\n    const handleCreateGroup = async (name: string, userIds: number[]) => {\r\n        try {\r\n            const chat = await messageService.createChat(userIds, name, true);\r\n            setChats(prev => [chat, ...prev]);\r\n            setActiveChatId(chat.id);\r\n            setIsMobileChatOpen(true);\r\n        } catch (e) {\r\n            console.error(e);\r\n            alert(\"Failed to create group\");\r\n        }\r\n    }\r\n\r\n    // Filter Logic\r\n    const filteredChats = chats.filter(c => c.name?.toLowerCase().includes(searchQuery.toLowerCase()));\r\n\r\n    const suggestedUsers = searchQuery\r\n        ? allUsers.filter(u => u.name.toLowerCase().includes(searchQuery.toLowerCase()))\r\n        : [];\r\n\r\n    const activeChat = chats.find(c => c.id === activeChatId);\r\n\r\n    return (\r\n        <div className=\"flex h-[calc(100vh-64px)] bg-slate-50 overflow-hidden font-sans\">\r\n            <CreateGroupModal\r\n                isOpen={isGroupModalOpen}\r\n                onClose={() => setIsGroupModalOpen(false)}\r\n                users={allUsers}\r\n                onCreate={handleCreateGroup}\r\n            />\r\n\r\n            {/* Sidebar */}\r\n            <div className={`w-full md:w-80 lg:w-96 bg-white border-r border-slate-200 flex flex-col ${isMobileChatOpen ? 'hidden md:flex' : 'flex'}`}>\r\n                <div className=\"p-4 border-b border-slate-100\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <h1 className=\"text-xl font-bold text-slate-800 tracking-tight\">Messages</h1>\r\n                        <button\r\n                            onClick={() => setIsGroupModalOpen(true)}\r\n                            className=\"p-2 text-slate-500 hover:text-blue-600 hover:bg-blue-50 rounded-full transition\"\r\n                            title=\"Create Group\"\r\n                        >\r\n                            <Users size={20} />\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"relative group\">\r\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition\" size={16} />\r\n                        <input\r\n                            className=\"w-full bg-slate-50 border-none rounded-xl py-2.5 pl-10 pr-4 text-sm focus:ring-2 focus:ring-blue-100 transition placeholder-slate-400 outline-none\"\r\n                            placeholder=\"Search chats or people...\"\r\n                            value={searchQuery}\r\n                            onChange={e => setSearchQuery(e.target.value)}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-y-auto\">\r\n                    {/* Active Chats */}\r\n                    <div className=\"p-2 space-y-1\">\r\n                        {filteredChats.map(chat => (\r\n                            <div\r\n                                key={chat.id}\r\n                                onClick={() => { setActiveChatId(chat.id); setIsMobileChatOpen(true); }}\r\n                                className={`p-3 rounded-xl flex items-center gap-3 cursor-pointer transition-all ${activeChatId === chat.id ? 'bg-blue-50 border-blue-100 shadow-sm' : 'hover:bg-slate-50 border-transparent'\r\n                                    } border`}\r\n                            >\r\n                                <div className={`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold shadow-sm ${chat.is_group ? 'bg-indigo-500' : 'bg-gradient-to-br from-blue-400 to-blue-600'}`}>\r\n                                    {chat.is_group ? <Users size={16} /> : (chat.name?.substring(0, 2).toUpperCase() || \"?\")}\r\n                                </div>\r\n                                <div className=\"flex-1 min-w-0\">\r\n                                    <div className=\"flex justify-between items-baseline mb-0.5\">\r\n                                        <h3 className={`text-sm font-semibold truncate ${activeChatId === chat.id ? 'text-blue-900' : 'text-slate-800'}`}>{chat.name}</h3>\r\n                                        <span className=\"text-[10px] text-slate-400\">\r\n                                            {chat.last_message_time ? new Date(chat.last_message_time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : ''}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between items-center\">\r\n                                        <p className=\"text-xs text-slate-500 truncate max-w-[85%]\">{chat.last_message || <span className=\"italic opacity-50\">No messages yet</span>}</p>\r\n                                        {chat.unread_count && chat.unread_count > 0 ? (\r\n                                            <span className=\"bg-blue-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[1.25rem] text-center shadow-sm\">\r\n                                                {chat.unread_count}\r\n                                            </span>\r\n                                        ) : null}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                        {filteredChats.length === 0 && !searchQuery && (\r\n                            <div className=\"text-center p-8 text-slate-400\">\r\n                                <p className=\"text-sm\">No conversations yet.</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Suggested Users (Search Results) */}\r\n                    {suggestedUsers.length > 0 && (\r\n                        <div className=\"p-2 border-t border-slate-100 mt-2\">\r\n                            <p className=\"px-3 py-2 text-xs font-bold text-slate-400 uppercase tracking-wider\">Start New Chat</p>\r\n                            {suggestedUsers.map(user => (\r\n                                <div\r\n                                    key={user.id}\r\n                                    onClick={() => handleCreateP2PChat(user.id)}\r\n                                    className=\"p-3 rounded-xl flex items-center gap-3 cursor-pointer hover:bg-slate-50 transition\"\r\n                                >\r\n                                    <div className=\"w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center text-slate-600 font-bold text-xs ring-2 ring-white\">\r\n                                        {user.name.substring(0, 2).toUpperCase()}\r\n                                    </div>\r\n                                    <div>\r\n                                        <p className=\"text-sm font-semibold text-slate-700\">{user.name}</p>\r\n                                        <p className=\"text-xs text-slate-400\">Click to message</p>\r\n                                    </div>\r\n                                    <ArrowLeft size={14} className=\"ml-auto text-slate-300 rotate-180\" />\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Chat Area */}\r\n            {activeChat ? (\r\n                <div className={`flex-1 flex flex-col bg-[#f8fafc] ${isMobileChatOpen ? 'flex' : 'hidden md:flex'}`}>\r\n                    {/* Header */}\r\n                    <div className=\"h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 shadow-sm z-10\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <button onClick={() => setIsMobileChatOpen(false)} className=\"md:hidden p-2 -ml-2 text-slate-500 hover:bg-gray-100 rounded-full\">\r\n                                <ArrowLeft size={20} />\r\n                            </button>\r\n                            <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-sm ${activeChat.is_group ? 'bg-indigo-500' : 'bg-gradient-to-br from-blue-400 to-blue-600'}`}>\r\n                                {activeChat.is_group ? <Users size={18} /> : activeChat.name?.substring(0, 2).toUpperCase()}\r\n                            </div>\r\n                            <div>\r\n                                <h2 className=\"font-bold text-slate-800 text-[15px]\">{activeChat.name}</h2>\r\n                                {activeChat.is_group && <span className=\"text-xs text-slate-500 font-medium bg-slate-100 px-2 py-0.5 rounded-full\">Group Chat</span>}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex gap-2 text-slate-400\">\r\n                            <button className=\"p-2 hover:bg-slate-50 hover:text-blue-600 rounded-full transition\"><Phone size={20} /></button>\r\n                            <button className=\"p-2 hover:bg-slate-50 hover:text-blue-600 rounded-full transition\"><Video size={20} /></button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Messages */}\r\n                    <div ref={messagesContainerRef} className=\"flex-1 overflow-y-auto p-6 space-y-3 bg-[radial-gradient(#e2e8f0_1px,transparent_1px)] [background-size:20px_20px]\">\r\n                        {messages.map((msg, idx) => {\r\n                            const isMe = msg.sender_id === currentUser?.id;\r\n                            const showSender = !isMe && activeChat.is_group && (idx === 0 || messages[idx - 1].sender_id !== msg.sender_id);\r\n\r\n                            return (\r\n                                <div key={msg.id} className={`flex w-full ${isMe ? 'justify-end' : 'justify-start'}`}>\r\n                                    <div className={`flex flex-col max-w-[75%] md:max-w-[60%] ${isMe ? 'items-end' : 'items-start'}`}>\r\n                                        {showSender && <span className=\"text-[10px] text-slate-500 mb-1 ml-2 font-medium\">{msg.sender?.name || 'Unknown'}</span>}\r\n                                        <div className={`px-4 py-2.5 rounded-2xl shadow-sm text-[14px] leading-relaxed break-words ${isMe\r\n                                            ? 'bg-blue-600 text-white rounded-br-none'\r\n                                            : 'bg-white text-slate-800 border border-slate-100 rounded-bl-none'\r\n                                            }`}>\r\n                                            <p>{msg.content}</p>\r\n                                        </div>\r\n                                        <span className=\"text-[10px] text-slate-400 mt-1 px-1 font-medium opacity-80\">{new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                        <div ref={messagesEndRef} />\r\n                    </div>\r\n\r\n                    {/* Input */}\r\n                    <div className=\"p-4 bg-white border-t border-slate-200\">\r\n                        <div className=\"flex items-center gap-3 bg-slate-50 border border-slate-200 rounded-2xl p-2 pr-2 shadow-sm focus-within:ring-2 focus-within:ring-blue-100 focus-within:border-blue-300 transition-all\">\r\n                            <button className=\"p-2 text-slate-400 hover:text-blue-600 transition\"><Paperclip size={20} /></button>\r\n                            <input\r\n                                className=\"flex-1 bg-transparent border-none focus:ring-0 text-slate-700 placeholder-slate-400 text-sm h-10\"\r\n                                placeholder=\"Type a message...\"\r\n                                value={inputText}\r\n                                onChange={e => setInputText(e.target.value)}\r\n                                onKeyDown={e => e.key === 'Enter' && handleSendMessage()}\r\n                            />\r\n                            <button\r\n                                onClick={handleSendMessage}\r\n                                disabled={!inputText.trim()}\r\n                                className=\"p-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition shadow-sm disabled:opacity-50 disabled:cursor-not-allowed hover:scale-105 active:scale-95\"\r\n                            >\r\n                                <Send size={18} fill=\"currentColor\" />\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"text-center mt-2\">\r\n                            <p className=\"text-[10px] text-slate-300\">Press Enter to send</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            ) : (\r\n                <div className=\"hidden md:flex flex-1 flex-col items-center justify-center text-slate-400 bg-slate-50/50\">\r\n                    <div className=\"w-24 h-24 bg-white rounded-full flex items-center justify-center mb-6 shadow-sm border border-slate-100\">\r\n                        <Smile size={40} className=\"text-blue-200\" />\r\n                    </div>\r\n                    <h3 className=\"text-lg font-bold text-slate-700 mb-2\">My Messages</h3>\r\n                    <p className=\"text-sm max-w-xs text-center text-slate-500\">Pick a person or group from the left to start chatting.</p>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default MessagesPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}