{"ast":null,"code":"class WebSocketService {\n  constructor() {\n    this.socket = null;\n    this.handlers = new Set();\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 5;\n    this.reconnectInterval = 3000;\n    this.token = null;\n  }\n  connect(token) {\n    if (this.socket && this.socket.readyState === WebSocket.OPEN) return;\n    this.token = token;\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    // Adjust the host as needed. Using 127.0.0.1:8000 for local dev if needed, \n    // or just window.location.host if it's served from the same.\n    // Given terminal output uvicorn is on port 8000.\n    const host = '127.0.0.1:8000';\n    const url = `${protocol}//${host}/api/v1/ws?token=${token}`;\n    this.socket = new WebSocket(url);\n    this.socket.onopen = () => {\n      console.log('WebSocket Connected');\n      this.reconnectAttempts = 0;\n    };\n    this.socket.onmessage = event => {\n      try {\n        const message = JSON.parse(event.data);\n        this.handlers.forEach(handler => handler(message));\n      } catch (error) {\n        console.error('WebSocket message error:', error);\n      }\n    };\n    this.socket.onclose = () => {\n      console.log('WebSocket Disconnected');\n      this.attemptReconnect();\n    };\n    this.socket.onerror = error => {\n      console.error('WebSocket Error:', error);\n    };\n  }\n  attemptReconnect() {\n    if (this.reconnectAttempts < this.maxReconnectAttempts && this.token) {\n      this.reconnectAttempts++;\n      console.log(`Attempting reconnect ${this.reconnectAttempts}...`);\n      setTimeout(() => this.connect(this.token), this.reconnectInterval);\n    }\n  }\n  subscribe(handler) {\n    this.handlers.add(handler);\n    return () => this.handlers.delete(handler);\n  }\n  disconnect() {\n    this.token = null;\n    if (this.socket) {\n      this.socket.close();\n      this.socket = null;\n    }\n  }\n}\nexport const webSocketService = new WebSocketService();","map":{"version":3,"names":["WebSocketService","constructor","socket","handlers","Set","reconnectAttempts","maxReconnectAttempts","reconnectInterval","token","connect","readyState","WebSocket","OPEN","protocol","window","location","host","url","onopen","console","log","onmessage","event","message","JSON","parse","data","forEach","handler","error","onclose","attemptReconnect","onerror","setTimeout","subscribe","add","delete","disconnect","close","webSocketService"],"sources":["D:/Collabryta/collabryta-frontend/src/services/websocketService.ts"],"sourcesContent":["export type WebSocketMessageType = 'notification' | 'message' | 'task' | 'meeting' | 'file';\r\n\r\nexport interface WebSocketMessage {\r\n    type: WebSocketMessageType;\r\n    action?: string;\r\n    data: any;\r\n}\r\n\r\ntype MessageHandler = (message: WebSocketMessage) => void;\r\n\r\nclass WebSocketService {\r\n    private socket: WebSocket | null = null;\r\n    private handlers: Set<MessageHandler> = new Set();\r\n    private reconnectAttempts = 0;\r\n    private maxReconnectAttempts = 5;\r\n    private reconnectInterval = 3000;\r\n    private token: string | null = null;\r\n\r\n    connect(token: string) {\r\n        if (this.socket && this.socket.readyState === WebSocket.OPEN) return;\r\n\r\n        this.token = token;\r\n        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\r\n        // Adjust the host as needed. Using 127.0.0.1:8000 for local dev if needed, \r\n        // or just window.location.host if it's served from the same.\r\n        // Given terminal output uvicorn is on port 8000.\r\n        const host = '127.0.0.1:8000';\r\n        const url = `${protocol}//${host}/api/v1/ws?token=${token}`;\r\n\r\n        this.socket = new WebSocket(url);\r\n\r\n        this.socket.onopen = () => {\r\n            console.log('WebSocket Connected');\r\n            this.reconnectAttempts = 0;\r\n        };\r\n\r\n        this.socket.onmessage = (event) => {\r\n            try {\r\n                const message: WebSocketMessage = JSON.parse(event.data);\r\n                this.handlers.forEach(handler => handler(message));\r\n            } catch (error) {\r\n                console.error('WebSocket message error:', error);\r\n            }\r\n        };\r\n\r\n        this.socket.onclose = () => {\r\n            console.log('WebSocket Disconnected');\r\n            this.attemptReconnect();\r\n        };\r\n\r\n        this.socket.onerror = (error) => {\r\n            console.error('WebSocket Error:', error);\r\n        };\r\n    }\r\n\r\n    private attemptReconnect() {\r\n        if (this.reconnectAttempts < this.maxReconnectAttempts && this.token) {\r\n            this.reconnectAttempts++;\r\n            console.log(`Attempting reconnect ${this.reconnectAttempts}...`);\r\n            setTimeout(() => this.connect(this.token!), this.reconnectInterval);\r\n        }\r\n    }\r\n\r\n    subscribe(handler: MessageHandler) {\r\n        this.handlers.add(handler);\r\n        return () => this.handlers.delete(handler);\r\n    }\r\n\r\n    disconnect() {\r\n        this.token = null;\r\n        if (this.socket) {\r\n            this.socket.close();\r\n            this.socket = null;\r\n        }\r\n    }\r\n}\r\n\r\nexport const webSocketService = new WebSocketService();\r\n"],"mappings":"AAUA,MAAMA,gBAAgB,CAAC;EAAAC,YAAA;IAAA,KACXC,MAAM,GAAqB,IAAI;IAAA,KAC/BC,QAAQ,GAAwB,IAAIC,GAAG,CAAC,CAAC;IAAA,KACzCC,iBAAiB,GAAG,CAAC;IAAA,KACrBC,oBAAoB,GAAG,CAAC;IAAA,KACxBC,iBAAiB,GAAG,IAAI;IAAA,KACxBC,KAAK,GAAkB,IAAI;EAAA;EAEnCC,OAAOA,CAACD,KAAa,EAAE;IACnB,IAAI,IAAI,CAACN,MAAM,IAAI,IAAI,CAACA,MAAM,CAACQ,UAAU,KAAKC,SAAS,CAACC,IAAI,EAAE;IAE9D,IAAI,CAACJ,KAAK,GAAGA,KAAK;IAClB,MAAMK,QAAQ,GAAGC,MAAM,CAACC,QAAQ,CAACF,QAAQ,KAAK,QAAQ,GAAG,MAAM,GAAG,KAAK;IACvE;IACA;IACA;IACA,MAAMG,IAAI,GAAG,gBAAgB;IAC7B,MAAMC,GAAG,GAAG,GAAGJ,QAAQ,KAAKG,IAAI,oBAAoBR,KAAK,EAAE;IAE3D,IAAI,CAACN,MAAM,GAAG,IAAIS,SAAS,CAACM,GAAG,CAAC;IAEhC,IAAI,CAACf,MAAM,CAACgB,MAAM,GAAG,MAAM;MACvBC,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAC;MAClC,IAAI,CAACf,iBAAiB,GAAG,CAAC;IAC9B,CAAC;IAED,IAAI,CAACH,MAAM,CAACmB,SAAS,GAAIC,KAAK,IAAK;MAC/B,IAAI;QACA,MAAMC,OAAyB,GAAGC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACI,IAAI,CAAC;QACxD,IAAI,CAACvB,QAAQ,CAACwB,OAAO,CAACC,OAAO,IAAIA,OAAO,CAACL,OAAO,CAAC,CAAC;MACtD,CAAC,CAAC,OAAOM,KAAK,EAAE;QACZV,OAAO,CAACU,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;MACpD;IACJ,CAAC;IAED,IAAI,CAAC3B,MAAM,CAAC4B,OAAO,GAAG,MAAM;MACxBX,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAC;MACrC,IAAI,CAACW,gBAAgB,CAAC,CAAC;IAC3B,CAAC;IAED,IAAI,CAAC7B,MAAM,CAAC8B,OAAO,GAAIH,KAAK,IAAK;MAC7BV,OAAO,CAACU,KAAK,CAAC,kBAAkB,EAAEA,KAAK,CAAC;IAC5C,CAAC;EACL;EAEQE,gBAAgBA,CAAA,EAAG;IACvB,IAAI,IAAI,CAAC1B,iBAAiB,GAAG,IAAI,CAACC,oBAAoB,IAAI,IAAI,CAACE,KAAK,EAAE;MAClE,IAAI,CAACH,iBAAiB,EAAE;MACxBc,OAAO,CAACC,GAAG,CAAC,wBAAwB,IAAI,CAACf,iBAAiB,KAAK,CAAC;MAChE4B,UAAU,CAAC,MAAM,IAAI,CAACxB,OAAO,CAAC,IAAI,CAACD,KAAM,CAAC,EAAE,IAAI,CAACD,iBAAiB,CAAC;IACvE;EACJ;EAEA2B,SAASA,CAACN,OAAuB,EAAE;IAC/B,IAAI,CAACzB,QAAQ,CAACgC,GAAG,CAACP,OAAO,CAAC;IAC1B,OAAO,MAAM,IAAI,CAACzB,QAAQ,CAACiC,MAAM,CAACR,OAAO,CAAC;EAC9C;EAEAS,UAAUA,CAAA,EAAG;IACT,IAAI,CAAC7B,KAAK,GAAG,IAAI;IACjB,IAAI,IAAI,CAACN,MAAM,EAAE;MACb,IAAI,CAACA,MAAM,CAACoC,KAAK,CAAC,CAAC;MACnB,IAAI,CAACpC,MAAM,GAAG,IAAI;IACtB;EACJ;AACJ;AAEA,OAAO,MAAMqC,gBAAgB,GAAG,IAAIvC,gBAAgB,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}