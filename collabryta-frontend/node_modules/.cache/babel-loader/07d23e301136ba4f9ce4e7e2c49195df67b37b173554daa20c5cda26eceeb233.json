{"ast":null,"code":"var _jsxFileName = \"D:\\\\Collabryta\\\\collabryta-frontend\\\\src\\\\pages\\\\Messages\\\\MessagesPage.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Search, Phone, Video, MoreVertical, Paperclip, Smile, Mic, Send, Check, CheckCheck, Play, Pause, ArrowLeft, PlusCircle } from \"lucide-react\";\nimport { messageService } from \"../../services/messageService\";\nimport { userService } from \"../../services/userService\";\nimport { authService } from \"../../services/authService\";\n\n// --- Types ---\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst COLORS = [\"bg-indigo-500\", \"bg-pink-500\", \"bg-teal-500\", \"bg-blue-600\", \"bg-purple-500\", \"bg-orange-500\"];\n\n// --- Components ---\n\nconst MessageBubble = ({\n  message,\n  isMe\n}) => {\n  _s();\n  const [isPlaying, setIsPlaying] = useState(false);\n  const audioRef = useRef(null);\n  const toggleAudio = () => {\n    if (!audioRef.current) return;\n    if (isPlaying) {\n      audioRef.current.pause();\n    } else {\n      audioRef.current.play();\n    }\n  };\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    const handledEnded = () => setIsPlaying(false);\n    audio.addEventListener('ended', handledEnded);\n    return () => audio.removeEventListener('ended', handledEnded);\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `flex w-full mb-4 ${isMe ? 'justify-end' : 'justify-start'}`,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `flex flex-col max-w-[70%] ${isMe ? 'items-end' : 'items-start'}`,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: `px-4 py-3 rounded-2xl shadow-sm text-sm ${isMe ? 'bg-blue-600 text-white rounded-tr-sm' : 'bg-white border border-gray-100 text-slate-800 rounded-tl-sm'}`,\n        children: message.audioUrl ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-3 min-w-[200px]\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: toggleAudio,\n            className: `p-2 rounded-full ${isMe ? 'bg-white/20' : 'bg-gray-100 hover:bg-gray-200'} transition`,\n            children: isPlaying ? /*#__PURE__*/_jsxDEV(Pause, {\n              size: 16\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 83,\n              columnNumber: 46\n            }, this) : /*#__PURE__*/_jsxDEV(Play, {\n              size: 16\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 83,\n              columnNumber: 68\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 82,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1 h-1 bg-current opacity-30 rounded-full overflow-hidden\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"h-full bg-current w-1/2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 86,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 85,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-xs opacity-80\",\n            children: [message.duration, \"s\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"audio\", {\n            ref: audioRef,\n            src: message.audioUrl,\n            onPlay: () => setIsPlaying(true),\n            onPause: () => setIsPlaying(false)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 25\n        }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"leading-relaxed\",\n          children: message.text\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-1 mt-1 px-1\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-[10px] text-gray-400 font-medium\",\n          children: message.time\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 21\n        }, this), isMe && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-blue-600\",\n          children: message.status === 'read' ? /*#__PURE__*/_jsxDEV(CheckCheck, {\n            size: 12\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 58\n          }, this) : /*#__PURE__*/_jsxDEV(Check, {\n            size: 12\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 85\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 72,\n    columnNumber: 9\n  }, this);\n};\n_s(MessageBubble, \"kgkST1S2DKv5NXgsyN6Nz0K7EnA=\");\n_c = MessageBubble;\nconst MessagesPage = () => {\n  _s2();\n  const [activeContactId, setActiveContactId] = useState(null);\n  const [contacts, setContacts] = useState([]);\n  const [allUsers, setAllUsers] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const [inputText, setInputText] = useState(\"\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const messagesEndRef = useRef(null);\n  const [isMobileChatOpen, setIsMobileChatOpen] = useState(false);\n  const [currentUser, setCurrentUser] = useState(null);\n\n  // Initial load and Polling\n  useEffect(() => {\n    const fetchUser = async () => {\n      try {\n        const user = await authService.getCurrentUser();\n        setCurrentUser(user);\n      } catch (e) {\n        console.error(\"Failed to load user\");\n      }\n    };\n    fetchUser();\n    const loadData = async () => {\n      try {\n        // 1. active conversations\n        const conversationsData = await messageService.getConversations();\n        const mappedConversations = conversationsData.map((u, idx) => ({\n          id: u.id,\n          name: u.name,\n          initials: u.name.substring(0, 2).toUpperCase(),\n          status: u.status || \"offline\",\n          lastMessage: u.last_message || \"No messages yet\",\n          time: u.last_message_time ? new Date(u.last_message_time).toLocaleTimeString([], {\n            hour: '2-digit',\n            minute: '2-digit'\n          }) : \"\",\n          unread: u.unread_count || 0,\n          color: COLORS[idx % COLORS.length],\n          type: \"personal\"\n        }));\n        setContacts(mappedConversations);\n\n        // 2. all users (directory)\n        const usersData = await userService.getAllUsers();\n        const mappedAllUsers = usersData.map((u, idx) => ({\n          id: u.id,\n          name: u.name,\n          initials: u.name.substring(0, 2).toUpperCase(),\n          status: u.is_active ? \"online\" : \"offline\",\n          lastMessage: \"\",\n          time: \"\",\n          unread: 0,\n          color: COLORS[idx % COLORS.length],\n          type: \"personal\"\n        }));\n        setAllUsers(mappedAllUsers);\n      } catch (error) {\n        console.error(\"Failed to load data\", error);\n      }\n    };\n    loadData();\n    const interval = setInterval(loadData, 5000); // Poll every 5s\n    return () => clearInterval(interval);\n  }, []);\n\n  // Load messages for active contact\n  useEffect(() => {\n    if (!activeContactId || !currentUser) return;\n    const loadMessages = async () => {\n      try {\n        const data = await messageService.getMessages(activeContactId);\n        const sorted = data.sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n        const mapped = sorted.map(m => ({\n          id: m.id,\n          senderId: m.sender_id === currentUser.id ? \"me\" : m.sender_id,\n          text: m.content,\n          time: new Date(m.timestamp).toLocaleTimeString([], {\n            hour: '2-digit',\n            minute: '2-digit'\n          }),\n          status: m.is_read ? \"read\" : \"delivered\"\n        }));\n        setMessages(mapped);\n      } catch (error) {\n        console.error(\"Failed to load messages\", error);\n      }\n    };\n    loadMessages();\n    const interval = setInterval(loadMessages, 3000); // Poll active chat faster\n    return () => clearInterval(interval);\n  }, [activeContactId, currentUser]);\n\n  // Derived State\n  const activeContact = contacts.find(c => c.id === activeContactId) || allUsers.find(c => c.id === activeContactId);\n\n  // Filter Logic\n  const filteredContacts = (() => {\n    const normalize = s => s.toLowerCase();\n    const query = normalize(searchQuery);\n    const convMatches = contacts.filter(c => normalize(c.name).includes(query));\n    if (!query) return convMatches;\n    const existingIds = new Set(contacts.map(c => c.id));\n    const userMatches = allUsers.filter(u => normalize(u.name).includes(query) && !existingIds.has(u.id) && u.id !== (currentUser === null || currentUser === void 0 ? void 0 : currentUser.id));\n    return [...convMatches, ...userMatches];\n  })();\n\n  // Auto-scroll\n  useEffect(() => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: 'smooth'\n    });\n  }, [messages, activeContactId]);\n\n  // Handlers\n  const handleSendMessage = async () => {\n    if (!inputText.trim() || !activeContactId) return;\n    try {\n      const sentMsg = await messageService.sendMessage(activeContactId, inputText);\n      const newMessage = {\n        id: sentMsg.id,\n        senderId: \"me\",\n        text: sentMsg.content,\n        time: new Date(sentMsg.timestamp).toLocaleTimeString([], {\n          hour: '2-digit',\n          minute: '2-digit'\n        }),\n        status: \"sent\"\n      };\n      setMessages(prev => [...prev, newMessage]);\n      setInputText(\"\");\n\n      // Optimistic update of sidebar\n      setContacts(prev => {\n        const existing = prev.find(c => c.id === activeContactId);\n        if (existing) {\n          return prev.map(c => c.id === activeContactId ? {\n            ...c,\n            lastMessage: inputText,\n            time: \"Just now\"\n          } : c);\n        } else {\n          // If it was a new chat from 'allUsers', add it to 'contacts' list locally\n          const newUser = allUsers.find(u => u.id === activeContactId);\n          if (newUser) {\n            return [{\n              ...newUser,\n              lastMessage: inputText,\n              time: \"Just now\"\n            }, ...prev];\n          }\n          return prev;\n        }\n      });\n    } catch (error) {\n      console.error(\"Failed to send message\", error);\n      alert(\"Failed to send message\");\n    }\n  };\n  const handleKeyDown = e => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  // Recording (Mock)\n  const [isRecording, setIsRecording] = useState(false);\n  const [recTime, setRecTime] = useState(0);\n  const mediaRecorderRef = useRef(null);\n  const audioChunks = useRef([]);\n  useEffect(() => {\n    let interval;\n    if (isRecording) {\n      interval = setInterval(() => setRecTime(t => t + 1), 1000);\n    }\n    return () => clearInterval(interval);\n  }, [isRecording]);\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: true\n      });\n      const recorder = new MediaRecorder(stream);\n      mediaRecorderRef.current = recorder;\n      audioChunks.current = [];\n      recorder.ondataavailable = e => audioChunks.current.push(e.data);\n      recorder.onstop = () => {\n        stream.getTracks().forEach(track => track.stop());\n        setRecTime(0);\n        alert(\"Voice messages are coming soon!\");\n      };\n      recorder.start();\n      setIsRecording(true);\n    } catch (err) {\n      console.error(\"Mic error\", err);\n      alert(\"Could not access microphone.\");\n    }\n  };\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex h-[calc(100vh-64px)] bg-white overflow-hidden border-t border-gray-100\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: `w-full md:w-80 lg:w-96 border-r border-gray-100 flex flex-col bg-white ${isMobileChatOpen ? 'hidden md:flex' : 'flex'}`,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-4 border-b border-gray-50\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-between items-center mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-xl font-bold text-slate-800\",\n            children: \"Messages\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 319,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition\",\n            children: /*#__PURE__*/_jsxDEV(PlusCircle, {\n              size: 20\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 321,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 320,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative\",\n          children: [/*#__PURE__*/_jsxDEV(Search, {\n            className: \"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\",\n            size: 18\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Search people...\",\n            value: searchQuery,\n            onChange: e => setSearchQuery(e.target.value),\n            className: \"w-full pl-10 pr-4 py-2 bg-slate-50 border-none rounded-xl text-sm focus:ring-2 focus:ring-blue-100 transition-all placeholder:text-slate-400\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 327,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 317,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 overflow-y-auto p-2 space-y-1\",\n        children: filteredContacts.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-col items-center justify-center pt-10 text-slate-400 px-6 text-center\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm\",\n            children: \"No conversations found.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 341,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-xs mt-2\",\n            children: \"Try searching for a colleague's name to start a new chat.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 342,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 25\n        }, this) : filteredContacts.map(contact => /*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: () => {\n            setActiveContactId(contact.id);\n            setIsMobileChatOpen(true);\n          },\n          className: `p-3 rounded-xl flex items-center gap-3 cursor-pointer transition-all ${activeContactId === contact.id ? 'bg-blue-50 border border-blue-100' : 'hover:bg-gray-50 border border-transparent'}`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"relative\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: `w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-sm ${contact.color}`,\n              children: contact.initials\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 358,\n              columnNumber: 37\n            }, this), contact.status === 'online' && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 362,\n              columnNumber: 41\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 357,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1 min-w-0\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex justify-between items-baseline mb-0.5\",\n              children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                className: `text-sm font-semibold truncate ${activeContactId === contact.id ? 'text-blue-900' : 'text-slate-700'}`,\n                children: contact.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 367,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: `text-[11px] font-medium ${activeContactId === contact.id ? 'text-blue-500' : 'text-slate-400'}`,\n                children: contact.time\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 370,\n                columnNumber: 41\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 366,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex justify-between items-center\",\n              children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                className: `text-xs truncate max-w-[85%] ${activeContactId === contact.id ? 'text-blue-700/80' : 'text-slate-500'}`,\n                children: contact.lastMessage || /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"italic opacity-70\",\n                  children: \"Start a conversation\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 376,\n                  columnNumber: 69\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 375,\n                columnNumber: 41\n              }, this), contact.unread > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"bg-blue-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[1.25rem] text-center\",\n                children: contact.unread\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 379,\n                columnNumber: 45\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 374,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 365,\n            columnNumber: 33\n          }, this)]\n        }, contact.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 346,\n          columnNumber: 29\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 338,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 13\n    }, this), activeContact ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `flex-1 flex flex-col bg-slate-50/30 ${isMobileChatOpen ? 'flex' : 'hidden md:flex'}`,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"h-16 bg-white border-b border-gray-100 px-6 flex items-center justify-between shadow-sm z-10\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setIsMobileChatOpen(false),\n            className: \"md:hidden p-2 -ml-2 text-slate-500 hover:bg-gray-100 rounded-full\",\n            children: /*#__PURE__*/_jsxDEV(ArrowLeft, {\n              size: 20\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 401,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-sm ${activeContact.color}`,\n            children: activeContact.initials\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 403,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              className: \"font-bold text-slate-800 text-base\",\n              children: activeContact.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 407,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center gap-1.5\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: `w-2 h-2 rounded-full ${activeContact.status === 'online' ? 'bg-green-500' : 'bg-gray-300'}`\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 409,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-xs text-slate-500 font-medium capitalize\",\n                children: activeContact.status\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 410,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 408,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 406,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 396,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-2 text-slate-400\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"p-2 hover:bg-gray-50 hover:text-blue-600 rounded-full transition\",\n            children: /*#__PURE__*/_jsxDEV(Phone, {\n              size: 20\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 415,\n              columnNumber: 114\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 415,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"p-2 hover:bg-gray-50 hover:text-blue-600 rounded-full transition\",\n            children: /*#__PURE__*/_jsxDEV(Video, {\n              size: 20\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 416,\n              columnNumber: 114\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-px h-5 bg-gray-200 mx-1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 417,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"p-2 hover:bg-gray-50 hover:text-blue-600 rounded-full transition\",\n            children: /*#__PURE__*/_jsxDEV(MoreVertical, {\n              size: 20\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 418,\n              columnNumber: 114\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 418,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 overflow-y-auto p-6 bg-[#f8fafc]\",\n        children: [messages.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"h-full flex flex-col items-center justify-center text-slate-400 opacity-60\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-4\",\n            children: /*#__PURE__*/_jsxDEV(Smile, {\n              size: 32\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 427,\n              columnNumber: 37\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 426,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"No messages yet. Say hello!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 429,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 425,\n          columnNumber: 29\n        }, this) : messages.map(msg => /*#__PURE__*/_jsxDEV(MessageBubble, {\n          message: msg,\n          isMe: msg.senderId === \"me\"\n        }, msg.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 433,\n          columnNumber: 33\n        }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: messagesEndRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 436,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 423,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-4 bg-white border-t border-gray-100\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: `flex items-center gap-2 bg-gray-50 border border-gray-200 rounded-2xl p-1.5 pl-3 transition-all ${isRecording ? 'border-red-200 bg-red-50' : 'focus-within:ring-2 focus-within:ring-blue-100 focus-within:border-blue-300'}`,\n          children: [isRecording ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1 flex items-center gap-3 px-2 h-10\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-3 h-3 bg-red-500 rounded-full animate-pulse\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 444,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-red-500 font-medium text-sm\",\n              children: [\"Recording \", recTime, \"s...\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 445,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 443,\n            columnNumber: 33\n          }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"p-1.5 text-slate-400 hover:text-blue-600 transition\",\n              children: /*#__PURE__*/_jsxDEV(Paperclip, {\n                size: 20\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 449,\n                columnNumber: 109\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 449,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              value: inputText,\n              onChange: e => setInputText(e.target.value),\n              onKeyDown: handleKeyDown,\n              placeholder: \"Type your message...\",\n              className: \"flex-1 bg-transparent border-none focus:ring-0 text-slate-700 placeholder:text-slate-400 text-sm h-10\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 450,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"p-1.5 text-slate-400 hover:text-blue-600 transition\",\n              children: /*#__PURE__*/_jsxDEV(Smile, {\n                size: 20\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 458,\n                columnNumber: 109\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 458,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true), inputText.trim() ? /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleSendMessage,\n            className: \"p-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 shadow-sm transition-all hover:scale-105 active:scale-95\",\n            children: /*#__PURE__*/_jsxDEV(Send, {\n              size: 18,\n              fill: \"currentColor\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 467,\n              columnNumber: 37\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 463,\n            columnNumber: 33\n          }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: isRecording ? stopRecording : startRecording,\n            className: `p-2.5 rounded-xl transition-all shadow-sm ${isRecording ? 'bg-red-500 text-white hover:bg-red-600 animate-pulse' : 'bg-white text-slate-500 hover:bg-blue-500 hover:text-white border border-gray-200'}`,\n            children: isRecording ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-4 h-4 bg-white rounded-sm\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 477,\n              columnNumber: 52\n            }, this) : /*#__PURE__*/_jsxDEV(Mic, {\n              size: 18\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 477,\n              columnNumber: 102\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 470,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 441,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-center text-[10px] text-gray-400 mt-2 font-medium\",\n          children: [\"Press \", /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"font-bold\",\n            children: \"Enter\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 481,\n            columnNumber: 101\n          }, this), \" to send\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 481,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 440,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 17\n    }, this) :\n    /*#__PURE__*/\n    /* Empty State */\n    _jsxDEV(\"div\", {\n      className: \"hidden md:flex flex-1 flex-col items-center justify-center bg-slate-50/50 text-slate-400\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-24 h-24 bg-white rounded-full flex items-center justify-center mb-6 shadow-sm border border-gray-100\",\n        children: /*#__PURE__*/_jsxDEV(Search, {\n          size: 40,\n          className: \"text-blue-300\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 488,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 487,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-lg font-bold text-slate-700 mb-2\",\n        children: \"Select a Conversation\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 490,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"max-w-xs text-center text-sm text-slate-500\",\n        children: \"Choose a contact from the sidebar or search for a colleague to start messaging.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 491,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 486,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 313,\n    columnNumber: 9\n  }, this);\n};\n_s2(MessagesPage, \"HPyseKf+lEOcTUUOJDuzjCwoiqc=\");\n_c2 = MessagesPage;\nexport default MessagesPage;\nvar _c, _c2;\n$RefreshReg$(_c, \"MessageBubble\");\n$RefreshReg$(_c2, \"MessagesPage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","Search","Phone","Video","MoreVertical","Paperclip","Smile","Mic","Send","Check","CheckCheck","Play","Pause","ArrowLeft","PlusCircle","messageService","userService","authService","jsxDEV","_jsxDEV","Fragment","_Fragment","COLORS","MessageBubble","message","isMe","_s","isPlaying","setIsPlaying","audioRef","toggleAudio","current","pause","play","audio","handledEnded","addEventListener","removeEventListener","className","children","audioUrl","onClick","size","fileName","_jsxFileName","lineNumber","columnNumber","duration","ref","src","onPlay","onPause","text","time","status","_c","MessagesPage","_s2","activeContactId","setActiveContactId","contacts","setContacts","allUsers","setAllUsers","messages","setMessages","inputText","setInputText","searchQuery","setSearchQuery","messagesEndRef","isMobileChatOpen","setIsMobileChatOpen","currentUser","setCurrentUser","fetchUser","user","getCurrentUser","e","console","error","loadData","conversationsData","getConversations","mappedConversations","map","u","idx","id","name","initials","substring","toUpperCase","lastMessage","last_message","last_message_time","Date","toLocaleTimeString","hour","minute","unread","unread_count","color","length","type","usersData","getAllUsers","mappedAllUsers","is_active","interval","setInterval","clearInterval","loadMessages","data","getMessages","sorted","sort","a","b","timestamp","getTime","mapped","m","senderId","sender_id","content","is_read","activeContact","find","c","filteredContacts","normalize","s","toLowerCase","query","convMatches","filter","includes","existingIds","Set","userMatches","has","_messagesEndRef$curre","scrollIntoView","behavior","handleSendMessage","trim","sentMsg","sendMessage","newMessage","prev","existing","newUser","alert","handleKeyDown","key","shiftKey","preventDefault","isRecording","setIsRecording","recTime","setRecTime","mediaRecorderRef","audioChunks","t","startRecording","stream","navigator","mediaDevices","getUserMedia","recorder","MediaRecorder","ondataavailable","push","onstop","getTracks","forEach","track","stop","start","err","stopRecording","placeholder","value","onChange","target","contact","msg","onKeyDown","fill","_c2","$RefreshReg$"],"sources":["D:/Collabryta/collabryta-frontend/src/pages/Messages/MessagesPage.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport {\r\n    Search,\r\n    Phone,\r\n    Video,\r\n    MoreVertical,\r\n    Paperclip,\r\n    Smile,\r\n    Mic,\r\n    Send,\r\n    Check,\r\n    CheckCheck,\r\n    Play,\r\n    Pause,\r\n    ArrowLeft,\r\n    PlusCircle\r\n} from \"lucide-react\";\r\nimport { messageService } from \"../../services/messageService\";\r\nimport type { Message as ServiceMessage } from \"../../services/messageService\";\r\nimport { userService } from \"../../services/userService\";\r\nimport { authService } from \"../../services/authService\";\r\n\r\n// --- Types ---\r\ninterface Contact {\r\n    id: number;\r\n    name: string;\r\n    initials: string;\r\n    status: \"online\" | \"offline\" | \"busy\" | \"away\";\r\n    lastMessage: string;\r\n    time: string;\r\n    unread: number;\r\n    color: string;\r\n    type: \"personal\" | \"group\";\r\n}\r\n\r\ninterface UiMessage {\r\n    id: number;\r\n    senderId: number | \"me\";\r\n    text: string;\r\n    time: string;\r\n    status: \"sent\" | \"delivered\" | \"read\";\r\n    audioUrl?: string;\r\n    duration?: number;\r\n}\r\n\r\nconst COLORS = [\"bg-indigo-500\", \"bg-pink-500\", \"bg-teal-500\", \"bg-blue-600\", \"bg-purple-500\", \"bg-orange-500\"];\r\n\r\n// --- Components ---\r\n\r\nconst MessageBubble: React.FC<{ message: UiMessage; isMe: boolean }> = ({ message, isMe }) => {\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const audioRef = useRef<HTMLAudioElement>(null);\r\n\r\n    const toggleAudio = () => {\r\n        if (!audioRef.current) return;\r\n        if (isPlaying) {\r\n            audioRef.current.pause();\r\n        } else {\r\n            audioRef.current.play();\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        const audio = audioRef.current;\r\n        if (!audio) return;\r\n        const handledEnded = () => setIsPlaying(false);\r\n        audio.addEventListener('ended', handledEnded);\r\n        return () => audio.removeEventListener('ended', handledEnded);\r\n    }, []);\r\n\r\n    return (\r\n        <div className={`flex w-full mb-4 ${isMe ? 'justify-end' : 'justify-start'}`}>\r\n            <div className={`flex flex-col max-w-[70%] ${isMe ? 'items-end' : 'items-start'}`}>\r\n                <div\r\n                    className={`px-4 py-3 rounded-2xl shadow-sm text-sm ${isMe\r\n                        ? 'bg-blue-600 text-white rounded-tr-sm'\r\n                        : 'bg-white border border-gray-100 text-slate-800 rounded-tl-sm'\r\n                        }`}\r\n                >\r\n                    {message.audioUrl ? (\r\n                        <div className=\"flex items-center gap-3 min-w-[200px]\">\r\n                            <button onClick={toggleAudio} className={`p-2 rounded-full ${isMe ? 'bg-white/20' : 'bg-gray-100 hover:bg-gray-200'} transition`}>\r\n                                {isPlaying ? <Pause size={16} /> : <Play size={16} />}\r\n                            </button>\r\n                            <div className=\"flex-1 h-1 bg-current opacity-30 rounded-full overflow-hidden\">\r\n                                <div className=\"h-full bg-current w-1/2\" />\r\n                            </div>\r\n                            <span className=\"text-xs opacity-80\">{message.duration}s</span>\r\n                            <audio ref={audioRef} src={message.audioUrl} onPlay={() => setIsPlaying(true)} onPause={() => setIsPlaying(false)} />\r\n                        </div>\r\n                    ) : (\r\n                        <p className=\"leading-relaxed\">{message.text}</p>\r\n                    )}\r\n                </div>\r\n                <div className=\"flex items-center gap-1 mt-1 px-1\">\r\n                    <span className=\"text-[10px] text-gray-400 font-medium\">{message.time}</span>\r\n                    {isMe && (\r\n                        <span className=\"text-blue-600\">\r\n                            {message.status === 'read' ? <CheckCheck size={12} /> : <Check size={12} />}\r\n                        </span>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst MessagesPage: React.FC = () => {\r\n    const [activeContactId, setActiveContactId] = useState<number | null>(null);\r\n    const [contacts, setContacts] = useState<Contact[]>([]);\r\n    const [allUsers, setAllUsers] = useState<Contact[]>([]);\r\n    const [messages, setMessages] = useState<UiMessage[]>([]);\r\n    const [inputText, setInputText] = useState(\"\");\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n    const messagesEndRef = useRef<HTMLDivElement>(null);\r\n    const [isMobileChatOpen, setIsMobileChatOpen] = useState(false);\r\n    const [currentUser, setCurrentUser] = useState<any>(null);\r\n\r\n    // Initial load and Polling\r\n    useEffect(() => {\r\n        const fetchUser = async () => {\r\n            try {\r\n                const user = await authService.getCurrentUser();\r\n                setCurrentUser(user);\r\n            } catch (e) {\r\n                console.error(\"Failed to load user\");\r\n            }\r\n        };\r\n        fetchUser();\r\n\r\n        const loadData = async () => {\r\n            try {\r\n                // 1. active conversations\r\n                const conversationsData = await messageService.getConversations();\r\n                const mappedConversations: Contact[] = conversationsData.map((u, idx) => ({\r\n                    id: u.id,\r\n                    name: u.name,\r\n                    initials: u.name.substring(0, 2).toUpperCase(),\r\n                    status: (u.status || \"offline\") as \"online\" | \"offline\" | \"busy\" | \"away\",\r\n                    lastMessage: u.last_message || \"No messages yet\",\r\n                    time: u.last_message_time ? new Date(u.last_message_time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : \"\",\r\n                    unread: u.unread_count || 0,\r\n                    color: COLORS[idx % COLORS.length],\r\n                    type: \"personal\"\r\n                }));\r\n                setContacts(mappedConversations);\r\n\r\n                // 2. all users (directory)\r\n                const usersData = await userService.getAllUsers();\r\n                const mappedAllUsers: Contact[] = usersData.map((u, idx) => ({\r\n                    id: u.id,\r\n                    name: u.name,\r\n                    initials: u.name.substring(0, 2).toUpperCase(),\r\n                    status: u.is_active ? \"online\" : \"offline\",\r\n                    lastMessage: \"\",\r\n                    time: \"\",\r\n                    unread: 0,\r\n                    color: COLORS[idx % COLORS.length],\r\n                    type: \"personal\"\r\n                }));\r\n                setAllUsers(mappedAllUsers);\r\n\r\n            } catch (error) {\r\n                console.error(\"Failed to load data\", error);\r\n            }\r\n        };\r\n\r\n        loadData();\r\n        const interval = setInterval(loadData, 5000); // Poll every 5s\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    // Load messages for active contact\r\n    useEffect(() => {\r\n        if (!activeContactId || !currentUser) return;\r\n\r\n        const loadMessages = async () => {\r\n            try {\r\n                const data: ServiceMessage[] = await messageService.getMessages(activeContactId);\r\n                const sorted = data.sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\r\n\r\n                const mapped: UiMessage[] = sorted.map(m => ({\r\n                    id: m.id,\r\n                    senderId: (m.sender_id === currentUser.id ? \"me\" : m.sender_id) as number | \"me\",\r\n                    text: m.content,\r\n                    time: new Date(m.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),\r\n                    status: m.is_read ? \"read\" : \"delivered\"\r\n                }));\r\n                setMessages(mapped);\r\n            } catch (error) {\r\n                console.error(\"Failed to load messages\", error);\r\n            }\r\n        };\r\n\r\n        loadMessages();\r\n        const interval = setInterval(loadMessages, 3000); // Poll active chat faster\r\n        return () => clearInterval(interval);\r\n    }, [activeContactId, currentUser]);\r\n\r\n    // Derived State\r\n    const activeContact = contacts.find(c => c.id === activeContactId) || allUsers.find(c => c.id === activeContactId);\r\n\r\n    // Filter Logic\r\n    const filteredContacts = (() => {\r\n        const normalize = (s: string) => s.toLowerCase();\r\n        const query = normalize(searchQuery);\r\n\r\n        const convMatches = contacts.filter(c => normalize(c.name).includes(query));\r\n\r\n        if (!query) return convMatches;\r\n\r\n        const existingIds = new Set(contacts.map(c => c.id));\r\n        const userMatches = allUsers.filter(u =>\r\n            normalize(u.name).includes(query) &&\r\n            !existingIds.has(u.id) &&\r\n            u.id !== currentUser?.id\r\n        );\r\n\r\n        return [...convMatches, ...userMatches];\r\n    })();\r\n\r\n    // Auto-scroll\r\n    useEffect(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n    }, [messages, activeContactId]);\r\n\r\n    // Handlers\r\n    const handleSendMessage = async () => {\r\n        if (!inputText.trim() || !activeContactId) return;\r\n\r\n        try {\r\n            const sentMsg = await messageService.sendMessage(activeContactId, inputText);\r\n            const newMessage: UiMessage = {\r\n                id: sentMsg.id,\r\n                senderId: \"me\",\r\n                text: sentMsg.content,\r\n                time: new Date(sentMsg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),\r\n                status: \"sent\"\r\n            };\r\n            setMessages(prev => [...prev, newMessage]);\r\n            setInputText(\"\");\r\n\r\n            // Optimistic update of sidebar\r\n            setContacts(prev => {\r\n                const existing = prev.find(c => c.id === activeContactId);\r\n                if (existing) {\r\n                    return prev.map(c => c.id === activeContactId ? { ...c, lastMessage: inputText, time: \"Just now\" } : c);\r\n                } else {\r\n                    // If it was a new chat from 'allUsers', add it to 'contacts' list locally\r\n                    const newUser = allUsers.find(u => u.id === activeContactId);\r\n                    if (newUser) {\r\n                        return [{ ...newUser, lastMessage: inputText, time: \"Just now\" }, ...prev];\r\n                    }\r\n                    return prev;\r\n                }\r\n            });\r\n\r\n        } catch (error) {\r\n            console.error(\"Failed to send message\", error);\r\n            alert(\"Failed to send message\");\r\n        }\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.key === 'Enter' && !e.shiftKey) {\r\n            e.preventDefault();\r\n            handleSendMessage();\r\n        }\r\n    };\r\n\r\n    // Recording (Mock)\r\n    const [isRecording, setIsRecording] = useState(false);\r\n    const [recTime, setRecTime] = useState(0);\r\n    const mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n    const audioChunks = useRef<Blob[]>([]);\r\n\r\n    useEffect(() => {\r\n        let interval: NodeJS.Timeout;\r\n        if (isRecording) {\r\n            interval = setInterval(() => setRecTime(t => t + 1), 1000);\r\n        }\r\n        return () => clearInterval(interval);\r\n    }, [isRecording]);\r\n\r\n    const startRecording = async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n            const recorder = new MediaRecorder(stream);\r\n            mediaRecorderRef.current = recorder;\r\n            audioChunks.current = [];\r\n            recorder.ondataavailable = (e) => audioChunks.current.push(e.data);\r\n            recorder.onstop = () => {\r\n                stream.getTracks().forEach(track => track.stop());\r\n                setRecTime(0);\r\n                alert(\"Voice messages are coming soon!\");\r\n            };\r\n            recorder.start();\r\n            setIsRecording(true);\r\n        } catch (err) {\r\n            console.error(\"Mic error\", err);\r\n            alert(\"Could not access microphone.\");\r\n        }\r\n    };\r\n\r\n    const stopRecording = () => {\r\n        if (mediaRecorderRef.current && isRecording) {\r\n            mediaRecorderRef.current.stop();\r\n            setIsRecording(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex h-[calc(100vh-64px)] bg-white overflow-hidden border-t border-gray-100\">\r\n            {/* --- Sidebar --- */}\r\n            <div className={`w-full md:w-80 lg:w-96 border-r border-gray-100 flex flex-col bg-white ${isMobileChatOpen ? 'hidden md:flex' : 'flex'}`}>\r\n                {/* Header */}\r\n                <div className=\"p-4 border-b border-gray-50\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <h2 className=\"text-xl font-bold text-slate-800\">Messages</h2>\r\n                        <button className=\"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition\">\r\n                            <PlusCircle size={20} />\r\n                        </button>\r\n                    </div>\r\n                    {/* Search */}\r\n                    <div className=\"relative\">\r\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" size={18} />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search people...\"\r\n                            value={searchQuery}\r\n                            onChange={(e) => setSearchQuery(e.target.value)}\r\n                            className=\"w-full pl-10 pr-4 py-2 bg-slate-50 border-none rounded-xl text-sm focus:ring-2 focus:ring-blue-100 transition-all placeholder:text-slate-400\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Contact List */}\r\n                <div className=\"flex-1 overflow-y-auto p-2 space-y-1\">\r\n                    {filteredContacts.length === 0 ? (\r\n                        <div className=\"flex flex-col items-center justify-center pt-10 text-slate-400 px-6 text-center\">\r\n                            <p className=\"text-sm\">No conversations found.</p>\r\n                            <p className=\"text-xs mt-2\">Try searching for a colleague's name to start a new chat.</p>\r\n                        </div>\r\n                    ) : (\r\n                        filteredContacts.map(contact => (\r\n                            <div\r\n                                key={contact.id}\r\n                                onClick={() => {\r\n                                    setActiveContactId(contact.id);\r\n                                    setIsMobileChatOpen(true);\r\n                                }}\r\n                                className={`p-3 rounded-xl flex items-center gap-3 cursor-pointer transition-all ${activeContactId === contact.id\r\n                                    ? 'bg-blue-50 border border-blue-100'\r\n                                    : 'hover:bg-gray-50 border border-transparent'\r\n                                    }`}\r\n                            >\r\n                                <div className=\"relative\">\r\n                                    <div className={`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-sm ${contact.color}`}>\r\n                                        {contact.initials}\r\n                                    </div>\r\n                                    {contact.status === 'online' && (\r\n                                        <div className=\"absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full\"></div>\r\n                                    )}\r\n                                </div>\r\n                                <div className=\"flex-1 min-w-0\">\r\n                                    <div className=\"flex justify-between items-baseline mb-0.5\">\r\n                                        <h3 className={`text-sm font-semibold truncate ${activeContactId === contact.id ? 'text-blue-900' : 'text-slate-700'}`}>\r\n                                            {contact.name}\r\n                                        </h3>\r\n                                        <span className={`text-[11px] font-medium ${activeContactId === contact.id ? 'text-blue-500' : 'text-slate-400'}`}>\r\n                                            {contact.time}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between items-center\">\r\n                                        <p className={`text-xs truncate max-w-[85%] ${activeContactId === contact.id ? 'text-blue-700/80' : 'text-slate-500'}`}>\r\n                                            {contact.lastMessage || <span className=\"italic opacity-70\">Start a conversation</span>}\r\n                                        </p>\r\n                                        {contact.unread > 0 && (\r\n                                            <span className=\"bg-blue-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[1.25rem] text-center\">\r\n                                                {contact.unread}\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* --- Chat Area --- */}\r\n            {activeContact ? (\r\n                <div className={`flex-1 flex flex-col bg-slate-50/30 ${isMobileChatOpen ? 'flex' : 'hidden md:flex'}`}>\r\n                    {/* Header */}\r\n                    <div className=\"h-16 bg-white border-b border-gray-100 px-6 flex items-center justify-between shadow-sm z-10\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <button\r\n                                onClick={() => setIsMobileChatOpen(false)}\r\n                                className=\"md:hidden p-2 -ml-2 text-slate-500 hover:bg-gray-100 rounded-full\"\r\n                            >\r\n                                <ArrowLeft size={20} />\r\n                            </button>\r\n                            <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-sm ${activeContact.color}`}>\r\n                                {activeContact.initials}\r\n                            </div>\r\n                            <div>\r\n                                <h2 className=\"font-bold text-slate-800 text-base\">{activeContact.name}</h2>\r\n                                <div className=\"flex items-center gap-1.5\">\r\n                                    <span className={`w-2 h-2 rounded-full ${activeContact.status === 'online' ? 'bg-green-500' : 'bg-gray-300'}`}></span>\r\n                                    <p className=\"text-xs text-slate-500 font-medium capitalize\">{activeContact.status}</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2 text-slate-400\">\r\n                            <button className=\"p-2 hover:bg-gray-50 hover:text-blue-600 rounded-full transition\"><Phone size={20} /></button>\r\n                            <button className=\"p-2 hover:bg-gray-50 hover:text-blue-600 rounded-full transition\"><Video size={20} /></button>\r\n                            <div className=\"w-px h-5 bg-gray-200 mx-1\"></div>\r\n                            <button className=\"p-2 hover:bg-gray-50 hover:text-blue-600 rounded-full transition\"><MoreVertical size={20} /></button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Content */}\r\n                    <div className=\"flex-1 overflow-y-auto p-6 bg-[#f8fafc]\">\r\n                        {messages.length === 0 ? (\r\n                            <div className=\"h-full flex flex-col items-center justify-center text-slate-400 opacity-60\">\r\n                                <div className=\"w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-4\">\r\n                                    <Smile size={32} />\r\n                                </div>\r\n                                <p>No messages yet. Say hello!</p>\r\n                            </div>\r\n                        ) : (\r\n                            messages.map(msg => (\r\n                                <MessageBubble key={msg.id} message={msg} isMe={msg.senderId === \"me\"} />\r\n                            ))\r\n                        )}\r\n                        <div ref={messagesEndRef} />\r\n                    </div>\r\n\r\n                    {/* Input */}\r\n                    <div className=\"p-4 bg-white border-t border-gray-100\">\r\n                        <div className={`flex items-center gap-2 bg-gray-50 border border-gray-200 rounded-2xl p-1.5 pl-3 transition-all ${isRecording ? 'border-red-200 bg-red-50' : 'focus-within:ring-2 focus-within:ring-blue-100 focus-within:border-blue-300'}`}>\r\n                            {isRecording ? (\r\n                                <div className=\"flex-1 flex items-center gap-3 px-2 h-10\">\r\n                                    <div className=\"w-3 h-3 bg-red-500 rounded-full animate-pulse\"></div>\r\n                                    <span className=\"text-red-500 font-medium text-sm\">Recording {recTime}s...</span>\r\n                                </div>\r\n                            ) : (\r\n                                <>\r\n                                    <button className=\"p-1.5 text-slate-400 hover:text-blue-600 transition\"><Paperclip size={20} /></button>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={inputText}\r\n                                        onChange={(e) => setInputText(e.target.value)}\r\n                                        onKeyDown={handleKeyDown}\r\n                                        placeholder=\"Type your message...\"\r\n                                        className=\"flex-1 bg-transparent border-none focus:ring-0 text-slate-700 placeholder:text-slate-400 text-sm h-10\"\r\n                                    />\r\n                                    <button className=\"p-1.5 text-slate-400 hover:text-blue-600 transition\"><Smile size={20} /></button>\r\n                                </>\r\n                            )}\r\n\r\n                            {inputText.trim() ? (\r\n                                <button\r\n                                    onClick={handleSendMessage}\r\n                                    className=\"p-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 shadow-sm transition-all hover:scale-105 active:scale-95\"\r\n                                >\r\n                                    <Send size={18} fill=\"currentColor\" />\r\n                                </button>\r\n                            ) : (\r\n                                <button\r\n                                    onClick={isRecording ? stopRecording : startRecording}\r\n                                    className={`p-2.5 rounded-xl transition-all shadow-sm ${isRecording\r\n                                        ? 'bg-red-500 text-white hover:bg-red-600 animate-pulse'\r\n                                        : 'bg-white text-slate-500 hover:bg-blue-500 hover:text-white border border-gray-200'\r\n                                        }`}\r\n                                >\r\n                                    {isRecording ? <div className=\"w-4 h-4 bg-white rounded-sm\" /> : <Mic size={18} />}\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                        <p className=\"text-center text-[10px] text-gray-400 mt-2 font-medium\">Press <span className=\"font-bold\">Enter</span> to send</p>\r\n                    </div>\r\n                </div>\r\n            ) : (\r\n                /* Empty State */\r\n                <div className=\"hidden md:flex flex-1 flex-col items-center justify-center bg-slate-50/50 text-slate-400\">\r\n                    <div className=\"w-24 h-24 bg-white rounded-full flex items-center justify-center mb-6 shadow-sm border border-gray-100\">\r\n                        <Search size={40} className=\"text-blue-300\" />\r\n                    </div>\r\n                    <h3 className=\"text-lg font-bold text-slate-700 mb-2\">Select a Conversation</h3>\r\n                    <p className=\"max-w-xs text-center text-sm text-slate-500\">Choose a contact from the sidebar or search for a colleague to start messaging.</p>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default MessagesPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}