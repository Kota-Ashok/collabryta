{"ast":null,"code":"var _jsxFileName = \"D:\\\\Collabryta\\\\collabryta-frontend\\\\src\\\\context\\\\NotificationContext.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\nimport { notificationService } from '../services/notificationService';\nimport NotificationToast from '../components/NotificationToast';\nimport { AnimatePresence } from 'framer-motion';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst NotificationContext = /*#__PURE__*/createContext(undefined);\nexport const NotificationProvider = ({\n  children\n}) => {\n  _s();\n  const [notifications, setNotifications] = useState([]);\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [toast, setToast] = useState(null);\n  const fetchNotifications = async () => {\n    if (!localStorage.getItem('token')) return;\n    try {\n      const data = await notificationService.getNotifications();\n      setNotifications(data);\n      setUnreadCount(data.filter(n => !n.is_read).length);\n    } catch (error) {\n      console.error('Failed to fetch notifications:', error);\n    }\n  };\n  useEffect(() => {\n    fetchNotifications();\n  }, []);\n  const showToast = useCallback(notif => {\n    setToast(notif);\n    // Toast auto-closes itself via the progress bar duration in UI, \n    // but we need to clear state here too.\n    setTimeout(() => setToast(null), 5050);\n  }, []);\n  const addNotification = useCallback(notification => {\n    setNotifications(prev => [notification, ...prev]);\n    if (!notification.is_read) {\n      setUnreadCount(prev => prev + 1);\n    }\n    showToast(notification);\n  }, [showToast]);\n  const markAsRead = async id => {\n    try {\n      await notificationService.markAsRead(id);\n      setNotifications(prev => prev.map(n => n.id === id ? {\n        ...n,\n        is_read: true\n      } : n));\n      setUnreadCount(prev => Math.max(0, prev - 1));\n    } catch (error) {\n      console.error('Failed to mark notification as read:', error);\n    }\n  };\n  const markAllAsRead = async () => {\n    try {\n      await notificationService.markAllAsRead();\n      setNotifications(prev => prev.map(n => ({\n        ...n,\n        is_read: true\n      })));\n      setUnreadCount(0);\n    } catch (error) {\n      console.error('Failed to mark all as read:', error);\n    }\n  };\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (!token) return;\n\n    // WebSocket connection\n    const wsUrl = `ws://localhost:8000/api/v1/ws?token=${token}`;\n    let ws;\n    const connect = () => {\n      ws = new WebSocket(wsUrl);\n      ws.onmessage = event => {\n        try {\n          const message = JSON.parse(event.data);\n          if (message.type === 'notification') {\n            addNotification(message.data);\n          }\n        } catch (err) {\n          console.error('Error parsing WS message:', err);\n        }\n      };\n      ws.onclose = () => {\n        console.log('WebSocket disconnected, retrying in 5s...');\n        setTimeout(connect, 5000);\n      };\n      ws.onerror = err => {\n        console.error('WebSocket error:', err);\n        ws.close();\n      };\n    };\n    connect();\n    return () => {\n      if (ws) ws.close();\n    };\n  }, [addNotification]);\n  return /*#__PURE__*/_jsxDEV(NotificationContext.Provider, {\n    value: {\n      notifications,\n      unreadCount,\n      addNotification,\n      markAsRead,\n      markAllAsRead\n    },\n    children: [children, /*#__PURE__*/_jsxDEV(AnimatePresence, {\n      children: toast && /*#__PURE__*/_jsxDEV(NotificationToast, {\n        notification: toast,\n        onClose: () => setToast(null)\n      }, toast.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 112,\n    columnNumber: 9\n  }, this);\n};\n_s(NotificationProvider, \"YOheHhGLKCleS7Wf3wndpYp3H8E=\");\n_c = NotificationProvider;\nexport const useNotifications = () => {\n  _s2();\n  const context = useContext(NotificationContext);\n  if (!context) throw new Error('useNotifications must be used within a NotificationProvider');\n  return context;\n};\n_s2(useNotifications, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nvar _c;\n$RefreshReg$(_c, \"NotificationProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useCallback","notificationService","NotificationToast","AnimatePresence","jsxDEV","_jsxDEV","NotificationContext","undefined","NotificationProvider","children","_s","notifications","setNotifications","unreadCount","setUnreadCount","toast","setToast","fetchNotifications","localStorage","getItem","data","getNotifications","filter","n","is_read","length","error","console","showToast","notif","setTimeout","addNotification","notification","prev","markAsRead","id","map","Math","max","markAllAsRead","token","wsUrl","ws","connect","WebSocket","onmessage","event","message","JSON","parse","type","err","onclose","log","onerror","close","Provider","value","onClose","fileName","_jsxFileName","lineNumber","columnNumber","_c","useNotifications","_s2","context","Error","$RefreshReg$"],"sources":["D:/Collabryta/collabryta-frontend/src/context/NotificationContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\r\nimport { notificationService, Notification } from '../services/notificationService';\r\nimport NotificationToast from '../components/NotificationToast';\r\nimport { AnimatePresence } from 'framer-motion';\r\n\r\ninterface NotificationContextType {\r\n    notifications: Notification[];\r\n    unreadCount: number;\r\n    addNotification: (notification: Notification) => void;\r\n    markAsRead: (id: number) => Promise<void>;\r\n    markAllAsRead: () => Promise<void>;\r\n}\r\n\r\nconst NotificationContext = createContext<NotificationContextType | undefined>(undefined);\r\n\r\nexport const NotificationProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const [notifications, setNotifications] = useState<Notification[]>([]);\r\n    const [unreadCount, setUnreadCount] = useState(0);\r\n    const [toast, setToast] = useState<Notification | null>(null);\r\n\r\n    const fetchNotifications = async () => {\r\n        if (!localStorage.getItem('token')) return;\r\n        try {\r\n            const data = await notificationService.getNotifications();\r\n            setNotifications(data);\r\n            setUnreadCount(data.filter(n => !n.is_read).length);\r\n        } catch (error) {\r\n            console.error('Failed to fetch notifications:', error);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchNotifications();\r\n    }, []);\r\n\r\n    const showToast = useCallback((notif: Notification) => {\r\n        setToast(notif);\r\n        // Toast auto-closes itself via the progress bar duration in UI, \r\n        // but we need to clear state here too.\r\n        setTimeout(() => setToast(null), 5050);\r\n    }, []);\r\n\r\n    const addNotification = useCallback((notification: Notification) => {\r\n        setNotifications(prev => [notification, ...prev]);\r\n        if (!notification.is_read) {\r\n            setUnreadCount(prev => prev + 1);\r\n        }\r\n        showToast(notification);\r\n    }, [showToast]);\r\n\r\n    const markAsRead = async (id: number) => {\r\n        try {\r\n            await notificationService.markAsRead(id);\r\n            setNotifications(prev => prev.map(n => n.id === id ? { ...n, is_read: true } : n));\r\n            setUnreadCount(prev => Math.max(0, prev - 1));\r\n        } catch (error) {\r\n            console.error('Failed to mark notification as read:', error);\r\n        }\r\n    };\r\n\r\n    const markAllAsRead = async () => {\r\n        try {\r\n            await notificationService.markAllAsRead();\r\n            setNotifications(prev => prev.map(n => ({ ...n, is_read: true })));\r\n            setUnreadCount(0);\r\n        } catch (error) {\r\n            console.error('Failed to mark all as read:', error);\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        const token = localStorage.getItem('token');\r\n        if (!token) return;\r\n\r\n        // WebSocket connection\r\n        const wsUrl = `ws://localhost:8000/api/v1/ws?token=${token}`;\r\n        let ws: WebSocket;\r\n\r\n        const connect = () => {\r\n            ws = new WebSocket(wsUrl);\r\n\r\n            ws.onmessage = (event) => {\r\n                try {\r\n                    const message = JSON.parse(event.data);\r\n                    if (message.type === 'notification') {\r\n                        addNotification(message.data);\r\n                    }\r\n                } catch (err) {\r\n                    console.error('Error parsing WS message:', err);\r\n                }\r\n            };\r\n\r\n            ws.onclose = () => {\r\n                console.log('WebSocket disconnected, retrying in 5s...');\r\n                setTimeout(connect, 5000);\r\n            };\r\n\r\n            ws.onerror = (err) => {\r\n                console.error('WebSocket error:', err);\r\n                ws.close();\r\n            };\r\n        };\r\n\r\n        connect();\r\n\r\n        return () => {\r\n            if (ws) ws.close();\r\n        };\r\n    }, [addNotification]);\r\n\r\n    return (\r\n        <NotificationContext.Provider value={{ notifications, unreadCount, addNotification, markAsRead, markAllAsRead }}>\r\n            {children}\r\n            <AnimatePresence>\r\n                {toast && (\r\n                    <NotificationToast\r\n                        key={toast.id}\r\n                        notification={toast}\r\n                        onClose={() => setToast(null)}\r\n                    />\r\n                )}\r\n            </AnimatePresence>\r\n        </NotificationContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useNotifications = () => {\r\n    const context = useContext(NotificationContext);\r\n    if (!context) throw new Error('useNotifications must be used within a NotificationProvider');\r\n    return context;\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}