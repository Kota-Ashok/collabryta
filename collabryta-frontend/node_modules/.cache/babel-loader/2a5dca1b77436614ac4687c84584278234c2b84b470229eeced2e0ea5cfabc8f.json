{"ast":null,"code":"import api from'./api';export const authService={login:async(email,password)=>{const params=new URLSearchParams();params.append('username',email);params.append('password',password);// OAuth2PasswordRequestForm expects form data\nconst response=await api.post('/auth/login',params,{headers:{'Content-Type':'application/x-www-form-urlencoded'}});if(response.data.access_token){localStorage.setItem('token',response.data.access_token);}return response.data;},register:async userData=>{const{name,email,password}=userData;const response=await api.post('/users/',{email,password,name});return response.data;},logout:()=>{localStorage.removeItem('token');},getCurrentUser:async()=>{const response=await api.get('/users/me');return response.data;},isAuthenticated:()=>{const token=localStorage.getItem('token');if(!token)return false;try{// More robust base64 decoding for JWT\nconst base64Url=token.split('.')[1];const base64=base64Url.replace(/-/g,'+').replace(/_/g,'/');const jsonPayload=decodeURIComponent(atob(base64).split('').map(function(c){return'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);}).join(''));const payload=JSON.parse(jsonPayload);const isExpired=payload.exp*1000<Date.now();if(isExpired){console.warn('Token expired at:',new Date(payload.exp*1000).toLocaleString());localStorage.removeItem('token');return false;}return true;}catch(e){console.error('Error validating token:',e);localStorage.removeItem('token');return false;}},updateProfile:async profileData=>{const response=await api.put('/users/me',profileData);return response.data;}};","map":{"version":3,"names":["api","authService","login","email","password","params","URLSearchParams","append","response","post","headers","data","access_token","localStorage","setItem","register","userData","name","logout","removeItem","getCurrentUser","get","isAuthenticated","token","getItem","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","payload","JSON","parse","isExpired","exp","Date","now","console","warn","toLocaleString","e","error","updateProfile","profileData","put"],"sources":["D:/Collabryta/collabryta-frontend/src/services/authService.ts"],"sourcesContent":["import api from './api';\r\n\r\nexport interface User {\r\n    id: number;\r\n    email: string;\r\n    name?: string;\r\n    role?: string;\r\n    avatar?: string;\r\n}\r\n\r\nexport const authService = {\r\n    login: async (email: string, password: string) => {\r\n        const params = new URLSearchParams();\r\n        params.append('username', email);\r\n        params.append('password', password);\r\n\r\n        // OAuth2PasswordRequestForm expects form data\r\n        const response = await api.post('/auth/login', params, {\r\n            headers: {\r\n                'Content-Type': 'application/x-www-form-urlencoded',\r\n            },\r\n        });\r\n        if (response.data.access_token) {\r\n            localStorage.setItem('token', response.data.access_token);\r\n        }\r\n        return response.data;\r\n    },\r\n\r\n    register: async (userData: any) => {\r\n        const { name, email, password } = userData;\r\n        const response = await api.post('/users/', {\r\n            email,\r\n            password,\r\n            name,\r\n        });\r\n        return response.data;\r\n    },\r\n\r\n    logout: () => {\r\n        localStorage.removeItem('token');\r\n    },\r\n\r\n    getCurrentUser: async () => {\r\n        const response = await api.get('/users/me');\r\n        return response.data;\r\n    },\r\n\r\n    isAuthenticated: () => {\r\n        const token = localStorage.getItem('token');\r\n        if (!token) return false;\r\n\r\n        try {\r\n            // More robust base64 decoding for JWT\r\n            const base64Url = token.split('.')[1];\r\n            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {\r\n                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\r\n            }).join(''));\r\n\r\n            const payload = JSON.parse(jsonPayload);\r\n            const isExpired = payload.exp * 1000 < Date.now();\r\n\r\n            if (isExpired) {\r\n                console.warn('Token expired at:', new Date(payload.exp * 1000).toLocaleString());\r\n                localStorage.removeItem('token');\r\n                return false;\r\n            }\r\n            return true;\r\n        } catch (e) {\r\n            console.error('Error validating token:', e);\r\n            localStorage.removeItem('token');\r\n            return false;\r\n        }\r\n    },\r\n\r\n    updateProfile: async (profileData: any) => {\r\n        const response = await api.put('/users/me', profileData);\r\n        return response.data;\r\n    }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}